(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{254:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>y});var a=s(72),t=s(4),i=s(6316),n=s.n(i),d=s(983),l=s(1835),o=s(7977),c=s(1288),m=s(8033),x=s(1241),h=s(9178),p=s(3644);function y(){let e=(0,d.useRouter)(),[r,s]=(0,t.useState)(1),[i,y]=(0,t.useState)(!1),[u,g]=(0,t.useState)(!1),[j,f]=(0,t.useState)({address:"",city:"",state:"",pincode:"",phone:""}),{user:b}=(0,x.A)(),{selectedBranch:N}=(0,p.x)(),{items:v,getTotalPrice:w,clearCart:P}=(0,h.x)(),_=w(),k=async()=>{g(!0);try{if(!b)return void alert("Please log in to place an order");let r={customerId:b.id,items:v.map(e=>({productId:e.id,quantity:e.quantity,unitPrice:e.price,totalPrice:e.price*e.quantity})),totalAmount:_,shippingAddress:{street:j.address,city:j.city,state:j.state,pincode:j.pincode},branchId:null==N?void 0:N.id},s=await fetch("/api/order-management/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw Error("Failed to create order");let a=await s.json();if(a.id){let r={orderId:a.id,amount:100*_,currency:"INR",customerId:b.id,customerEmail:b.email,customerPhone:b.phone||"9999999999"},s=await fetch("/api/payment-processing/razorpay/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw Error("Failed to create payment");let t=await s.json();if(t.success){let r={key:t.key,amount:t.amount,currency:t.currency,name:"LeafyHealth",description:"Order #".concat(a.id),order_id:t.razorpayOrderId,handler:async function(r){try{let s={razorpay_order_id:r.razorpay_order_id,razorpay_payment_id:r.razorpay_payment_id,razorpay_signature:r.razorpay_signature,orderId:a.id},t=await fetch("/api/payment-processing/razorpay/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw Error("Payment verification failed");(await t.json()).success?(await fetch("/api/notification-service/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:b.id,type:"order_confirmation",title:"Order Confirmed",message:"Your order #".concat(a.id," has been confirmed and will be delivered soon."),channel:"email"})}),P(),e.push("/order-success?orderId=".concat(a.id))):alert("Payment verification failed. Please contact support.")}catch(e){console.error("Payment verification error:",e),alert("Payment processing error. Please contact support.")}},prefill:{name:b.name,email:b.email,contact:b.phone||"9999999999"},theme:{color:"#22c55e"}};new window.Razorpay(r).open()}else alert("Payment initialization failed. Please try again.")}else alert("Order creation failed. Please try again.")}catch(e){console.error("Order processing error:",e),alert("Order failed. Please try again.")}finally{g(!1)}};return i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n(),{children:(0,a.jsx)("title",{children:"Order Confirmed - Sri Venkateswara Organic Foods"})}),(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-green-50",children:[(0,a.jsx)(o.A,{}),(0,a.jsx)(l.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6},className:"pt-24 pb-16 px-4",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto text-center",children:(0,a.jsxs)(m.A,{className:"p-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-6",children:"✅"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Order Confirmed!"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 mb-6",children:"Thank you for your order. We'll deliver your fresh groceries within 30 minutes."}),(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[(0,a.jsx)("p",{className:"text-green-800 font-semibold",children:"Order #SVF-2025-001"}),(0,a.jsx)("p",{className:"text-green-600",children:"Estimated delivery: 6:30 PM - 7:00 PM"})]}),(0,a.jsx)("button",{onClick:()=>window.location.href="/order-history",className:"bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors",children:"Track Your Order"})]})})}),(0,a.jsx)(c.A,{})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"Checkout - Sri Venkateswara Organic Foods"}),(0,a.jsx)("meta",{name:"description",content:"Complete your order and schedule delivery"})]}),(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-green-50",children:[(0,a.jsx)(o.A,{}),(0,a.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"pt-24 pb-16 px-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)(l.P.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.6},className:"text-4xl font-bold text-gray-900 mb-8",children:"Checkout"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.6},className:"space-y-6",children:[(0,a.jsxs)(m.A,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Delivery Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"రాజు"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"కుమార్"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"+91 98765 43210"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Address"}),(0,a.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",rows:3,placeholder:"House No, Street Name, Locality, Vijayawada, Andhra Pradesh"})]})]})]}),(0,a.jsxs)(m.A,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Delivery Time"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"border-2 border-green-600 bg-green-50 rounded-lg p-4 cursor-pointer",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-green-800",children:"Express Delivery"}),(0,a.jsx)("p",{className:"text-sm text-green-600",children:"Within 30 minutes"})]}),(0,a.jsx)("div",{className:"text-green-600",children:"\uD83D\uDE9A"})]})}),(0,a.jsx)("div",{className:"border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-green-300",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-700",children:"Schedule Delivery"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Choose your time"})]}),(0,a.jsx)("div",{className:"text-gray-400",children:"\uD83D\uDCC5"})]})})]})]}),(0,a.jsxs)(m.A,{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Payment Method"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"border-2 border-green-600 bg-green-50 rounded-lg p-4 cursor-pointer",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"payment",className:"mr-3",defaultChecked:!0}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-green-800",children:"Cash on Delivery"}),(0,a.jsx)("p",{className:"text-sm text-green-600",children:"Pay when your order arrives"})]})]})}),(0,a.jsx)("div",{className:"border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-green-300",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"payment",className:"mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-700",children:"Razorpay (UPI/Card)"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Pay securely online"})]})]})})]})]})]})}),(0,a.jsx)("div",{children:(0,a.jsx)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6,duration:.6},children:(0,a.jsxs)(m.A,{className:"p-6 sticky top-24",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Order Summary"}),(0,a.jsx)("div",{className:"space-y-4 mb-6",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),e.name_telugu&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.name_telugu}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Qty: ",e.quantity]})]}),(0,a.jsxs)("p",{className:"font-semibold",children:["₹",(e.price*e.quantity).toFixed(2)]})]},e.id))}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsxs)("span",{children:["₹",_.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Delivery Fee"}),(0,a.jsx)("span",{className:"text-green-600",children:"Free"})]}),(0,a.jsx)("div",{className:"border-t pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["₹",_.toFixed(2)]})]})})]}),(0,a.jsx)("button",{onClick:k,className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors mt-6",children:"Place Order"})]})})})]})]})}),(0,a.jsx)(c.A,{})]})]})}},512:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return s(254)}])},1241:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});var a=s(7014);function t(){let{data:e,isLoading:r}=(0,a.I)({queryKey:["/api/auth/user"],retry:!1});return{user:e,isLoading:r,isAuthenticated:!!e}}}},e=>{var r=r=>e(e.s=r);e.O(0,[133,636,593,792],()=>r(512)),_N_E=e.O()}]);